{% load static %}

<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dashboard</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@300;400;600&family=Poppins:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{% static 'home.css' %}">
    <link rel="stylesheet" href="{% static 'generalchat.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="vignette"></div>
    <div class="blur-background"></div>
    <header>
        <h1><a href="{% url 'home_page' %}" class="logo">Transcendance</a></h1>
        <div>
            <a href="{% url 'general_chat' %}" class="header-btn">Chat</a>
            <a href="{% url 'user_logout' %}" class="header-btn logout-btn">Logout</a>
            <a href="{% url 'user_dashboard' %}" class="header-btn profile-btn">Profile</a>
        </div>
    </header>
    <div class="background-container"></div> <!-- Ajout du conteneur pour l'image de fond -->
    <div class="chat-container">
        <div class="user-list">
            <div id="userList">
            </div>
            <button id="newChatButton">New Chat</button>
        </div>
        <div class="chat-window">
            <div class="selected-user">Select a user or group to start chatting</div>
            <div id="messages"></div>
            <div class="message-input">
                <textarea id="messageText" placeholder="Type your message here..."></textarea>
                <input type="hidden" id="imageData" />
                <div id="imagePreview"></div>
                <button id="sendMessage">Send</button>
            </div>
        </div>
    </div>

    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-btn" onclick="closePopup()">&times;</span>
            <h3>Invite players to the game !</h3>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search...">
                <button type="button">Search</button>
            </div>
            <!-- Nouvelle section pour afficher le r√©sultat de la recherche -->
            <div id="searchResult" class="search-result" style="display: none;">
                <!-- Le r√©sultat de la recherche sera inject√© ici -->
            </div>
            <div class="users-and-invited-container"> <!-- Conteneur parent pour Flexbox -->
                <div class="user-list-container"> <!-- Ajoutez l'identifiant ici -->
                    <div class="user-list" id="user-list">
                        <div class="user-item">
                            <img src="https://media1.tenor.com/m/xK38NWayRnoAAAAC/dog-eyes.gif" alt="Nom d'utilisateur"
                                class="user-image">
                            <span class="user-name">Famacito</span>
                            <button class="invite-button">Invite</button>
                        </div>
                        <div class="user-item">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQb2KRrG26uJLRrL55aWnKPGezf8V5ZkiHPHg&s"
                                alt="Nom d'utilisateur" class="user-image">
                            <span class="user-name">Dark_Sasuke</span>
                            <button class="invite-button">Invite</button>
                        </div>
                        <div class="user-item">
                            <img src="data:image/jpeg;base64,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"
                                alt="Nom d'utilisateur" class="user-image">
                            <span class="user-name">Bebouüçë</span>
                            <button class="invite-button">Invite</button>
                        </div>
                        <div class="user-item">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTbkxMv-c0E43vDxqPuuJ9-BDdHTu01PECQkg&s"
                                alt="Nom d'utilisateur" class="user-image">
                            <span class="user-name">Beverly_du_ghetto</span>
                            <button class="invite-button">Invite</button>
                        </div>
                        <div class="user-item">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTqiUJf2G0-bMDEnHRE4XIBLP_FKfACo2geiWaypHs8dVT8_GOaj-qjO3Pp59E6Y8hYM80&usqp=CAU"
                                alt="Nom d'utilisateur" class="user-image">
                            <span class="user-name">Julien.</span>
                            <button class="invite-button">Invite</button>
                        </div>
                        <!-- Ajoutez plus d'utilisateurs ici -->
                    </div>
                </div>
                <div class="user-list-container" id="invitedUsers">
                    <h3>Invited Players</h3>
                    <!-- Les utilisateurs invit√©s seront affich√©s ici -->
                </div>
            </div>
            <button class="start-button">Start</button>
        </div>
    </div>
    <script>
        var popup = document.querySelector('.popup');
        var blurBackground = document.querySelector('.blur-background');

        blurBackground.addEventListener('click', function (event) {
            if (event.target === blurBackground) {
                popup.style.display = 'none';
                blurBackground.style.display = 'none';
            }
        });

        function openPopup() {
            var popup = document.getElementById('popup');
            popup.style.display = 'block';
            document.body.style.overflow = 'hidden';
            document.querySelector('.blur-background').style.display = 'block';
            document.querySelector('.blur-background').style.display = 'block'; // Afficher la superposition noire
            document.querySelector('.blur-background').style.display = 'none'; // Cacher la superposition noire
        }

        function closePopup() {
            var popup = document.getElementById('popup');
            popup.style.display = 'none';
            document.body.style.overflow = '';
            document.querySelector('.blur-background').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function () {
            const newChatButton = document.getElementById('newChatButton');
            const inviteButtons = document.querySelectorAll('.invite-button');
            const popup = document.getElementById('popup');
            const blurBackground = document.querySelector('.blur-background');
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.querySelector('.search-container button');
            const userItems = document.querySelectorAll('.user-item');



            // Fonction pour ouvrir la popup
            function openPopup() {
                popup.style.display = 'block';
                document.body.style.overflow = 'hidden';
                blurBackground.style.display = 'block';
            }

            // Fonction pour fermer la popup
            function closePopup() {
                popup.style.display = 'none';
                document.body.style.overflow = '';
                blurBackground.style.display = 'none';
            }

            newChatButton.addEventListener('click', function (event) {
                openPopup();
            });

            function searchUsers() {
                var searchText = document.getElementById('searchInput').value.toLowerCase();
                var users = document.querySelectorAll('.user-item');
                var searchResultDiv = document.getElementById('searchResult');
                searchResultDiv.innerHTML = ''; // Effacer les r√©sultats pr√©c√©dents
                searchResultDiv.style.display = 'none'; // Masquer le div en attendant

                for (let user of users) {
                    var name = user.querySelector('.user-name').textContent.toLowerCase();
                    if (name.includes(searchText)) {
                        var userClone = user.cloneNode(true); // Cloner l'√©l√©ment trouv√©
                        searchResultDiv.appendChild(userClone); // Ajouter le clone au div de r√©sultat
                        searchResultDiv.style.display = ''; // Afficher le div de r√©sultat
                        break; // Sortir apr√®s avoir trouv√© le premier utilisateur correspondant
                    }
                }
            }

            // Modifier l'√©couteur d'√©v√©nements pour utiliser la fonction searchUsers lors de la saisie
            document.getElementById('searchInput').addEventListener('input', searchUsers);


            document.querySelector('.search-container button').addEventListener('click', searchUsers);

            // Ecouteur d'√©v√©nements pour les boutons "Invite"
            document.body.addEventListener('click', function (event) {
                if (event.target.classList.contains('invite-button')) {
                    const userItem = event.target.closest('.user-item');
                    const clonedUserItem = userItem.cloneNode(true);
                    const userName = userItem.querySelector('.user-name').textContent; // Obtenez le nom d'utilisateur
                    const isInvited = event.target.textContent === 'Invite';

                    // Mettre √† jour le texte et la couleur du bouton
                    event.target.textContent = isInvited ? '‚úñ' : 'Invite';
                    event.target.style.backgroundColor = isInvited ? 'red' : '#4CAF50';

                    const targetContainerId = isInvited ? 'invitedUsers' : 'user-list';
                    const targetContainer = document.getElementById(targetContainerId);

                    if (isInvited && targetContainerId === 'invitedUsers') {
                        // Si on invite l'utilisateur, cherchez et supprimez l'original de la liste des utilisateurs
                        const originalUserItems = document.querySelectorAll('#user-list .user-item');
                        originalUserItems.forEach(function (item) {
                            const itemUserName = item.querySelector('.user-name').textContent;
                            if (itemUserName === userName) {
                                item.remove(); // Supprimez l'√©l√©ment d'origine de la liste des utilisateurs
                            }
                        });
                    }

                    targetContainer.appendChild(userItem); // Ajoutez l'utilisateur invit√© au conteneur cible
                }
            });

            // Gestion du clic sur le fond flou pour fermer la popup
            blurBackground.addEventListener('click', function () {
                closePopup();
            });
        });

        function updateScrollbars() {
            const userListContainer = document.getElementById('user-list');
            const invitedUsersContainer = document.getElementById('invitedUsers');

            if (userListContainer.children.length === 0) {
                userListContainer.style.overflowY = 'hidden';
            } else {
                userListContainer.style.overflowY = 'auto';
            }

            if (invitedUsersContainer.children.length === 0) {
                invitedUsersContainer.style.overflowY = 'hidden';
            } else {
                invitedUsersContainer.style.overflowY = 'auto';
            }
        }

        // Appelez cette fonction apr√®s toute op√©ration qui modifie le nombre d'utilisateurs invit√©s
        updateScrollbars();
        forceReflow(document.getElementById('user-list'));
        forceReflow(document.getElementById('invitedUsers'));

    </script>
    <script src={% static 'utils.js' %}></script>
    <script src={% static 'generalchat.js' %}></script>
</body>

</html>