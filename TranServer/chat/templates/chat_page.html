{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="sidebar">
        <h2>Chats</h2>
        <ul id="chat-list">
            <!-- Dynamic list of chat buttons will be rendered here -->
        </ul>
        <button id="new-chat-btn">New Chat</button>
    </div>
    <div class="main-content">
        <div id="chat-messages">
            <!-- Chat messages will be rendered here -->
        </div>
    </div>
</div>

<!-- JavaScript code for fetching chats -->
<script>
    function fetchChats() {
        fetch('/api/chats/')
        .then(response => response.json())
        .then(data => {
            const chatListElement = document.getElementById('chat-list');
            chatListElement.innerHTML = ''; // Clear the existing list
            data.chats.forEach(chat => {
                const listItem = document.createElement('li');
                listItem.textContent = `Chat with ${chat.participants.join(', ')}`;
				listItem.textContent += ` id: ` + chat.id;
				listItem.dataset.chatId = chat.id; // Set the chat ID as a data attribute
                chatListElement.appendChild(listItem);
            });
        })
        .catch(error => console.error('Error fetching chats:', error));
    }

    window.addEventListener('load', fetchChats);
	function fetchChatMessages(chatId) {
		fetch(`/api/chats/${chatId}`)
		.then(response => response.json())
		.then(data => {
			// Process the data (e.g., display chat messages in the main chat area)
			console.log(data);
			displayChatMessages(data.messages);
		})
		.catch(error => console.error('Error fetching chat messages:', error));
	}
	
	// Define a function to display chat messages in the main chat area
	function displayChatMessages(messages) {
		const chatMessagesElement = document.getElementById('chat-messages');
		chatMessagesElement.innerHTML = ''; // Clear the existing messages
		messages.forEach(message => {
			const messageElement = document.createElement('div');
			messageElement.textContent = `${message.sender}: ${message.content}`;
			chatMessagesElement.appendChild(messageElement);
		});
	}
	
	// Attach event listener to chat list items to fetch messages when clicked
	document.getElementById('chat-list').addEventListener('click', function(event) {
		const chatItem = event.target.closest('li');
		if (chatItem) {
			const chatId = chatItem.dataset.chatId;
			fetchChatMessages(chatId);
		}
	}
	);
</script>
{% endblock %}